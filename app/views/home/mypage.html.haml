.common_container#mypage
  %h2= @subtitle
  %article#mypage_main
    #mypage_profile
      = render 'profile/profile', user: current_user
    %nav#mypage_navi
      = render 'home/mypage/menu'
  - comments = []
  - games = Game.of_user(current_user).playing.desc(:updated_at).limit(3).to_a
  - not_author_comments = Comment.of_not_author(current_user)
  - if games.present?
    - comments = not_author_comments.of_game(games).desc(:created_at).limit(3).to_a
    %ul.tabs#games_tab
      - %w(playing).each do |page|
        - name = t("pages.controllers.games.#{page}")
        - href = { controller: 'games', action: page }
        - html_classes = []
        - if page == 'playing'
          - html_classes << 'active'
        %li
          = link_to name, href, class: html_classes
  - else
    - games = Game.desc(:updated_at).limit(3).to_a
    %ul.tabs#games_tab
      %li
        %span.active
          = t("game.everyone")
  = render 'games/games', games: games, with_pagination: false
  %ul.tabs#comments_tab
    %li
      %span.active
        = Comment.model_name.human
  - if comments.blank? && current_user.friend_ids?
    - comments = not_author_comments.of_author_friends(current_user).desc(:created_at).limit(3).to_a
  - if comments.blank?
    - comments = not_author_comments.desc(:created_at).limit(3).to_a
  = render 'comments/comments', comments: comments, with_pagination: false, with_game: true
